FROM ubuntu

RUN apt-get update

#Install golang
RUN apt-get install -y wget
RUN apt-get install -y curl
RUN apt-get install -y make
RUN wget https://golang.org/dl/go1.15.5.linux-amd64.tar.gz
RUN tar -C /usr/local -xzf go1.15.5.linux-amd64.tar.gz
RUN export PATH=$PATH:/usr/local/go/bin

#Install elasticsearch
RUN apt-get install -y gnupg2
RUN wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -
RUN apt-get install apt-transport-https
RUN echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | tee /etc/apt/sources.list.d/elastic-7.x.list
RUN apt-get update && apt-get install -y elasticsearch

#Install redis
RUN apt install -y redis-server

# WORKDIR /app 
COPY . .
RUN apt-get -y upgrade
RUN make install
RUN go mod tidy

EXPOSE 11000

CMD ["/bin/bash", "script"]